jQuery(function($){slp_Filter=function(id){var callbacks,method,topic;topic=id&&slp.topics[id];if(!topic){if(typeof jQuery.Callbacks!=="undefined"){callbacks=jQuery.Callbacks();topic={publish:callbacks.fire,subscribe:callbacks.add,unsubscribe:callbacks.remove}}else{slp.log("jQuery 1.7.0+ required, "+jQuery.fn.version+" used instead.");topic={publish:function(data){return data}}}if(id){slp.topics[id]=topic}}return topic};slp={generic_object:{a:document.createElement("a")},important_object:{address_div:{},address_input:{},find_button:{},map:{},results:{},search_form:{},slp_div:{}},topics:{},sensor:{},run:function(){slp.init();slp.start_map()},geocoder:{geocode:function(request,callback){jQuery.getJSON(encodeURI(slplus.rest_url+"geocode/"+slplus.apikey+"/"+request.region+"/"+request.address)).done(function(resp){if(resp.error_message){var ref_phrase=", with referer";if(resp.error_message.includes(ref_phrase)){resp.error_message=resp.error_message.substring(0,resp.error_message.indexOf(ref_phrase))}}else{resp.error_message=""}callback(resp.results,resp.status,resp.error_message)}).fail(function(resp){callback(resp,google.maps.GeocoderStatus.ERROR)})}},log:function(message){if(window.console){console.log(message)}},notification:function(){this.inline=function(header,message){var html='<div class="container fluid grid-list-lg" style="min-height: 0px;">'+'<div class="layout row wrap">'+'<div class="flex xs12">'+'<div class="white--text card blue-grey darken-2" data-ripple="false" style="height: auto;">'+'<div class="card__title card__title--primary">'+'<div class="headline">'+header+"</div>"+"<div>"+message+"</div>"+"</div>"+"</div>"+"</div>"+"</div>"+"</div>";return html}},option:{get_from_server:function(option_name,callback){if(typeof slplus.shortcode_attributes[option_name]!=="undefined"){callback({value:slplus.shortcode_attributes[option_name]});return}jQuery.getJSON(encodeURI(slplus.rest_url+"options/filtered/"+option_name)).done(function(resp){if(resp.error_message){console.log(resp.error_message)}else{resp.error_message=""}callback(resp)}).fail(function(resp){console.log("get_from_server failed")})}},start_map:function(){if(jQuery("#map").length){if(typeof slplus!=="undefined"){if(typeof google!=="undefined"){slp.setup_helpers();slp.setup_map();slp.subscriptions.initalize();slplus.notifications=new slp.notification}else{jQuery("#map").html("Looks like you turned off Store Locator Plus® Maps under General Settings but need them here.")}}else{jQuery("#map").html("Store Locator Plus® did not initialize properly.")}}}};slp.init=function(){if(typeof slplus!=="undefined"){if(window.location.protocol!==slplus.ajaxurl.substring(0,slplus.ajaxurl.indexOf(":")+1)){slplus.ajaxurl=slplus.ajaxurl.replace(slplus.ajaxurl.substring(0,slplus.ajaxurl.indexOf(":")+1),window.location.protocol)}}var radioCheck=/radio|checkbox/i,keyBreaker=/[^\[\]]+/g,numberMatcher=/^[\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?$/;var isNumber=function(value){if(typeof value==="number"){return true}if(typeof value!=="string"){return false}return value.match(numberMatcher)};jQuery.fn.extend({formParams:function(convert){if(this[0].nodeName.toLowerCase()=="form"&&this[0].elements){return jQuery(jQuery.makeArray(this[0].elements)).getParams(convert)}return jQuery("input[name], textarea[name], select[name]",this[0]).getParams(convert)},getParams:function(convert){var data={},current;convert=convert===undefined?true:convert;this.each(function(){var el=this,type=el.type&&el.type.toLowerCase();if(type=="submit"||!el.name){return}var key=el.name,value=jQuery.data(el,"value")||jQuery.fn.val.call([el]),isRadioCheck=radioCheck.test(el.type),parts=key.match(keyBreaker),write=!isRadioCheck||!!el.checked,lastPart;if(convert){if(isNumber(value)){value=parseFloat(value)}else if(value==="true"||value==="false"){value=Boolean(value)}}current=data;for(var i=0;i<parts.length-1;i++){if(!current[parts[i]]){current[parts[i]]={}}current=current[parts[i]]}lastPart=parts[parts.length-1];if(lastPart in current&&type==="checkbox"){if(!jQuery.isArray(current[lastPart])){current[lastPart]=current[lastPart]===undefined?[]:[current[lastPart]]}if(write){current[lastPart].push(value)}}else if(write||!current[lastPart]){current[lastPart]=write?value:undefined}});return data}})};slp.shortcode_output=function(currentLocation,field_name,value,modifier,modarg,modifier2,modarg2){var output;output=value.shortcode_modifier({modifier:modifier,modarg:modarg,field_name:field_name,marker:currentLocation});if(modifier2){output=output.shortcode_modifier({modifier:modifier2,modarg:modarg2,field_name:field_name,marker:currentLocation})}return output};slp.setup_helpers=function(){slp.important_object={address_row:jQuery("#addy_in_address"),address_input:jQuery("#addressInput"),map:jQuery("#map"),results:jQuery("#map_sidebar"),search_form:jQuery("#searchForm"),slp_div:jQuery("div.store_locator_plus")};String.prototype.replace_shortcodes=function(){var args=arguments;var currentLocation=args[0];var shortcode_complex_regex=/\[(\w+)\s+([\w\.]+)\s*(\w*)(?:[\s="]*)([\w|\.]*)(?:[\s"]*)\s*(\w*)(?:[\s="]*)([\w|\.]*)(?:[\s"]*)\]/g;return this.replace(shortcode_complex_regex,function(match,shortcode,attribute,modifier,modarg,modifier2,modarg2){var field_name,output,value;switch(shortcode){case"slp_location":if(attribute==="latitude"){attribute="lat"}if(attribute==="longitude"){attribute="lng"}value="";field_name="";if(currentLocation[attribute]){value=currentLocation[attribute];field_name=attribute}else if(attribute.indexOf(".")>1){var dot_notation_regex=/(\w+)/gi;var data_parts=attribute.match(dot_notation_regex);var marker_array_name=data_parts[0];if(!currentLocation[marker_array_name]){return""}var marker_array_field=data_parts[1];value=currentLocation[marker_array_name][marker_array_field];if(!value){return""}field_name=marker_array_name+"_"+marker_array_field}else{return""}output=value.shortcode_modifier({modifier:modifier,modarg:modarg,field_name:field_name,marker:currentLocation});if(modifier2){output=output.shortcode_modifier({modifier:modifier2,modarg:modarg2,field_name:field_name,marker:currentLocation})}return output;case"slp_option":var options=slplus.options;slp_Filter("replace_shortcodes_options").publish(options);if(attribute==="name"){attribute=modarg;modarg=""}if(!options[attribute]){jQuery.ajax({url:slplus.rest_url+"options/"+attribute,dataType:"json",success:function(json_data){var response;if(typeof json_data==="string"){response=jQuery.parseJSON(json_data)}else{response=json_data}options[attribute]=response.value;output=slp.shortcode_output(currentLocation,field_name,options[attribute],modifier,modarg,modifier2,modarg2);jQuery('span[data-option="'+attribute+'"][data-locationid="'+currentLocation.id+'"]').html(output).show()},error:function(jqXHR,textStatus,errorThrown){return""}});return'<span data-option="'+attribute+'" data-locationid="'+currentLocation.id+'"></span>'}else{return slp.shortcode_output(currentLocation,field_name,options[attribute],modifier,modarg,modifier2,modarg2)}case"html":var output="";switch(attribute){case"br":output="<br/>";break;case"closing_anchor":output="</a>";break;default:break}output=output.shortcode_modifier({modifier:modifier,modarg:modarg,field_name:"raw_html",marker:currentLocation});if(modifier2){output=output.shortcode_modifier({modifier:modifier2,modarg:modarg2,field_name:"raw_html",marker:currentLocation})}return output;case"slp_addon":return"";default:return match+" not supported"}})};String.prototype.shortcode_modifier=function(){var args=arguments;var full_mod=args[0];var modifier=full_mod.modifier;var modarg=full_mod.modarg;var field_name=full_mod.field_name;var raw_output=true;var get_marker_data=function(element,marker){var split_element=element.split(".");if(split_element.length===1){return marker.data[element]}else{return marker.data[split_element[1]]}};if(field_name==="hours"){raw_output=false}var value=this;var prefix="";var suffix="";if(modifier){switch(modifier){case"ifset":if(!get_marker_data(modarg,full_mod.marker)){return""}break;case"ifnotset":if(get_marker_data(modarg,full_mod.marker)){return""}break;case"suffix":switch(modarg){case"br":suffix="<br/>";break;case"comma":suffix=",";break;case"comma_space":suffix=", ";break;case"space":suffix=" ";break;default:break}break;case"wrap":switch(modarg){case"directions":prefix='<a href="https://'+slplus.options.map_domain+"/maps?saddr="+encodeURIComponent(cslmap.getSearchAddress(cslmap.address))+"&daddr="+encodeURIComponent(full_mod.marker["fullAddress"])+'" target="_blank" class="storelocatorlink">';suffix="</a> ";break;case"img":prefix='<img src="';suffix='" class="sl_info_bubble_main_image">';break;case"mailto":prefix='<a href="mailto:';suffix='" target="_blank" class="storelocatorlink">';break;case"website":prefix='<a href="';suffix='" '+'target="'+(slplus.options.use_same_window!=="0"?"_self":"_blank")+'" '+'id="slp_marker_website" '+'class="storelocatorlink" '+">";break;case"fullspan":prefix='<span class="results_line location_'+field_name+'">';suffix="</span>";break;default:break}break;case"format":switch(modarg){case"decimal1":value=parseFloat(value).toFixed(1);break;case"decimal2":value=parseFloat(value).toFixed(2);break;case"sanitize":value=value.replace(/\W/g,"_");break;case"text":value=jQuery("<div/>").html(value).text();break;default:break}break;case"raw":raw_output=true;break;default:break}}var newOutput=raw_output?value:jQuery("<div/>").html(value).text();return prefix+newOutput+suffix}};slp.setup_map=function(){cslmap=new slp_Map;slp_Filter("slp_map_ready").publish(cslmap);if(!slplus.options.use_sensor){cslmap.usingSensor=false;if(slplus.options.id_addr!=null){cslmap.address=slplus.options.id_addr}if(!cslmap.address&&slplus.options.map_center){cslmap.address=slplus.options.map_center}if(slplus.options.map_center_lat&&slplus.options.map_center_lng){if(typeof cslmap.build_map==="function"){var map_center=new google.maps.LatLng(slplus.options.map_center_lat,slplus.options.map_center_lng);cslmap.build_map(map_center)}}else{cslmap.doGeocode()}}};slp.subscriptions=function(){var loading_class="loading_locations";this.initialize=function(){slp_Filter("load_marker_action").subscribe(show_locations_processing);slp_Filter("location_search_responded").subscribe(remove_locations_processing)};this.show_locations_processing=function(){slp.important_object.slp_div.addClass(loading_class)};this.remove_locations_processing=function(){slp.important_object.slp_div.removeClass(loading_class)};return{initalize:initialize}}();function gm_authFailure(){var html=slplus.notifications.inline(slplus.messages.slp_system_message,slplus.messages.no_api_key);jQuery("#map").prepend(html)}var slp_Marker=function(map,title,position,markerImage,location_id){this.__map=map;this.__title=title;this.__position=position;this.__gmarker=null;this.__markerImage=markerImage;this.__location_id=location_id;this.__init=function(){slp_Filter("marker").publish(this);this.__gmarker=new google.maps.Marker({position:this.__position,map:this.__map.gmap,title:this.__title,icon:this.protocol_tweaker(this.__markerImage)})};this.protocol_tweaker=function(icon_url){slp.generic_object.a.href=icon_url;if(slp.generic_object.a.hostname!==window.location.hostname)return icon_url;slp.generic_object.a.protocol=window.location.protocol;return slp.generic_object.a.href};this.__init()};var slp_Map=function(){var _this=this;this.auto_bound=true;this.infowindow=new google.maps.InfoWindow;this.geocoder=slp.geocoder;this.geocoder_request=new Object;this.gmap=null;this.map_hidden=true;this.default_radius="40000";this.address=null;this.draggable=true;this.markers=null;this.usingSensor=false;this.mapHomeIconUrl=null;this.mapType=null;this.options=null;this.centerMarker=null;this.active_marker=null;this.marker=null;this.bounds=null;this.homePoint=null;this.lastCenter=null;this.lastRadius=null;this.latest_response=null;this.search_options=null;this.__init=function(){if(typeof slplus==="undefined"){var html=slplus.notifications.inline(slplus.messages.slp_system_message,slplus.messages.script_not_loaded);jQuery(".store_locator_plus").prepend(html);return}this.mapType=slplus.options.map_type;this.mapHomeIconUrl=slplus.options.map_home_icon;var addressInput=this.getSearchAddress();if(typeof addressInput==="undefined"){this.address=slplus.options.map_center}else{this.address=addressInput}google.maps.event.addListener(this.infowindow,"domready",function(){jQuery(".slp_info_bubble").parent().addClass("slp_bubble_level_1");jQuery(".slp_info_bubble").parent().parent().addClass("slp_bubble_level_2");jQuery(".slp_info_bubble").parent().parent().parent().addClass("slp_bubble_level_3");jQuery(".slp_info_bubble").parent().parent().parent().parent().addClass("slp_bubble_level_4");jQuery(".slp_bubble_level_4").children("div:first-child").addClass("slp_bubble_elements");jQuery(".slp_bubble_level_4").children("div:last-child").addClass("slp_bubble_closer");jQuery(".slp_bubble_elements").children("div:first-child").addClass("slp_bubble_tail_behind");jQuery(".slp_bubble_elements").children("div:nth-child(2)").addClass("slp_bubble_behind");jQuery(".slp_bubble_elements").children("div:nth-child(3)").addClass("slp_bubble_tail_pieces");jQuery(".slp_bubble_tail_pieces").children("div:first-child").addClass("slp_bubble_left_tail");jQuery(".slp_bubble_left_tail").children("div:first-child").addClass("slp_bubble_left_tail_back");jQuery(".slp_bubble_tail_pieces").children("div:last-child").addClass("slp_bubble_right_tail");jQuery(".slp_bubble_right_tail").children("div:first-child").addClass("slp_bubble_right_tail_back");jQuery(".slp_bubble_elements").children("div:nth-child(4)").addClass("slp_bubble_background");jQuery(".slp_info_bubble").parent().parent().parent().parent().parent().addClass("slp_bubble_level_5");jQuery(".slp_info_bubble").parent().parent().parent().parent().parent().parent().addClass("slp_bubble_level_6")})};if(typeof slplus.options.hide_map==="undefined"||slplus.options.hide_map!=="1"){this.build_map=function(center,map_div_id){if(!map_div_id){map_div_id=document.getElementById("map")}if(this.gmap!==null){return}this.options={center:center,mapTypeId:this.mapType,minZoom:1,zoom:parseInt(slplus.options.zoom_level)};if(slplus.options.google_map_style){jQuery.extend(this.options,{styles:JSON.parse(slplus.options.google_map_style)})}slp_Filter("map_options").publish(this.options);this.gmap=new google.maps.Map(map_div_id,this.options);google.maps.event.addListener(this.gmap,"bounds_changed",function(){_this.__waitForTileLoad.call(_this)});if(this.show_home_marker()){this.homePoint=center;this.addMarkerAtCenter()}if(slplus.options.immediately_show_locations!=="0"){var radius=null;slplus.options.initial_radius=slplus.options.initial_radius.replace(/\D/g,"");if(/^[0-9]+$/.test(slplus.options.initial_radius)){radius=slplus.options.initial_radius}this.search_options=null;this.load_markers(center,radius)}slp_Filter("map_built").publish()}}this.set_active_marker_to_location=function(location_id){jQuery.each(this.markers,function(index,marker){if(marker.__location_id==location_id){cslmap.active_marker=marker;return false}})};this.show_home_marker=function(){return this.usingSensor||slplus.options.immediately_show_locations!=="0"&&slplus.options.no_homeicon_at_start!=="1"};this.__waitForTileLoad=function(){if(this.__tilesLoaded===null){this.__tilesLoaded=google.maps.event.addListener(this.gmap,"tilesloaded",function(){_this.__tilesAreLoaded.call(_this)})}};this.__tilesAreLoaded=function(){jQuery("#map").find("img").css({"max-width":"none"});google.maps.event.removeListener(this.__tilesLoaded);this.__tilesLoaded=null};this.addMarkerAtCenter=function(){if(this.centerMarker){this.centerMarker.__gmarker.setMap(null)}if(this.homePoint){this.centerMarker=new slp_Marker(this,"",this.homePoint,this.mapHomeIconUrl,0)}};this.clearMarkers=function(){if(this.markers){for(markerNumber in this.markers){if(typeof this.markers[markerNumber]!=="undefined"){if(typeof this.markers[markerNumber].__gmarker!=="undefined"){this.markers[markerNumber].__gmarker.setMap(null)}}}this.markers.length=0;if(!this.saneValue("addressInput","")){this.centerMarker=null;this.homePoint=null}}};this.putMarkers=function(markerListNatural){var location_data,markerCount,sidebar;this.markers=[];sidebar=document.getElementById("map_sidebar");sidebar.innerHTML="";markerCount=markerListNatural?markerListNatural.length:0;if(markerCount===0){if(this.homePoint&&this.auto_bound){this.gmap.panTo(this.homePoint)}slp.option.get_from_server("message_no_results",function(response){if(response.value){document.getElementById("map_sidebar").innerHTML='<div class="no_results_found"><h2>'+response.value+"</h2></div>"}else{console.log("No results found.  No message set.")}})}else{var results_html={content:"",insert_rows_at:"#map_sidebar"};slp_Filter("location_results_header").publish(results_html);if(results_html.content.trim()){slp.important_object.results.append(results_html.content)}var bounds=new google.maps.LatLngBounds;if(this.homePoint){bounds.extend(this.homePoint)}for(var markerNumber=0;markerNumber<markerCount;++markerNumber){if(markerListNatural[markerNumber]==null){slp.log("SLP marker number "+markerNumber+" is null. ");continue}if(typeof markerListNatural[markerNumber].data!=="undefined"){location_data=markerListNatural[markerNumber].data}else{location_data=markerListNatural[markerNumber]}if(!markerListNatural[markerNumber].position){markerListNatural[markerNumber].position=new google.maps.LatLng(markerListNatural[markerNumber].lat,markerListNatural[markerNumber].lng)}bounds.extend(markerListNatural[markerNumber].position);this.markers.push(new slp_Marker(this,location_data.sl_store,markerListNatural[markerNumber].position,_this.is_valid_icon(markerListNatural[markerNumber].icon)?markerListNatural[markerNumber].icon:slplus.options.map_end_icon,location_data.sl_id));google.maps.event.addListener(this.markers[markerNumber].__gmarker,"click",function(infoData,marker){return function(){_this.show_map_bubble.call(_this,infoData,marker)}}(markerListNatural[markerNumber],this.markers[markerNumber]));if(sidebar){jQuery(results_html.insert_rows_at).append(this.createSidebar(markerListNatural[markerNumber]));jQuery(results_html.insert_rows_at+" span:empty").hide();jQuery("#slp_results_wrapper_"+markerListNatural[markerNumber].id).on("click",null,{info:markerListNatural[markerNumber],marker:this.markers[markerNumber]},_this.handle_location_result_click)}}if(this.gmap){this.bounds=bounds;if(this.auto_bound){this.gmap.fitBounds(this.bounds);if(slplus.options.no_autozoom==="1"){this.gmap.setZoom(parseInt(slplus.options.zoom_level))}else{var current_zoom=this.gmap.getZoom();var zoom_tweak=parseInt(slplus.options.zoom_tweak);var new_zoom=current_zoom-zoom_tweak;if(markerCount<2){new_zoom=Math.min(new_zoom,15)}this.gmap.setZoom(new_zoom)}}}}slp.important_object.results.trigger("contentchanged")};this.handle_location_result_click=function(event){jQuery(this).trigger("result_clicked",event);_this.show_map_bubble(event.data.info,event.data.marker)};this.is_valid_icon=function(icon){return icon!==null&&typeof icon!=="undefined"&&icon.length>4};this.show_map_bubble=function(infoData,marker){this.options={show_bubble:slplus.options.hide_bubble!=="1"};slp_Filter("map_options").publish(this.options);if(this.options.show_bubble){this.infowindow.setContent(this.createMarkerContent(infoData));this.infowindow.open(this.gmap,marker.__gmarker)}};this.process_geocode_response=function(results,status,message){if(status===google.maps.GeocoderStatus.OK&&results.length>0){var geocode_results={all:results,request:_this.geocoder_request,best:results[0]};slp_Filter("geocode_results").publish(geocode_results);if(typeof geocode_results.best.geometry.location!==google.maps.LatLng){geocode_results.best.geometry.location=new google.maps.LatLng(geocode_results.best.geometry.location.lat,geocode_results.best.geometry.location.lng)}if(_this.gmap===null){if(typeof _this.build_map==="function"){_this.build_map(geocode_results.best.geometry.location)}}else{_this.homePoint=geocode_results.best.geometry.location;_this.addMarkerAtCenter();_this.load_markers(geocode_results.best.geometry.location,_this.saneValue("radiusSelect","40000"))}}else{if(_this.gmap===null){if(typeof _this.build_map==="function"){slp.log("Map set to fallback lat/lng: "+slplus.options.map_center_lat+" , "+slplus.options.map_center_lng);_this.homePoint=new google.maps.LatLng(slplus.options.map_center_lat,slplus.options.map_center_lng);_this.build_map(_this.homePoint);_this.addMarkerAtCenter()}}else{slp.option.get_from_server("message_bad_address",function(response){if(response.value){document.getElementById("map_sidebar").innerHTML=response.value+"<br/>"+'<p class="geocode_message">'+"Google Maps API error: <br/>"+message+"<br/>"+'Tired of fighting the Google Maps API?  Try <a href="https://storelocatorplus.com/">our SaaS offering</a>.';"</p>"}else{console.log("Bad address.  No message set.")}});_this.clearMarkers()}}};this.doGeocode=function(){var results;_this.geocoder_request["address"]=_this.address;_this.geocoder_request["region"]=typeof slplus.options.map_region!=="undefined"&&slplus.options.map_region?slplus.options.map_region:"us";if(slplus.options.searchnear==="currentmap"){if(_this.gmap){_this.geocoder_request["bounds"]=_this.gmap.getBounds()}}slp_Filter("geocoder_request").publish(_this.geocoder_request);_this.geocoder.geocode(_this.geocoder_request,_this.process_geocode_response)};this.__createAddress=function(aMarker){var address="";if(aMarker.address!==""){address+=aMarker.address}if(aMarker.address2!==""){address+=", "+aMarker.address2}if(aMarker.city!==""){address+=", "+aMarker.city}if(aMarker.state!==""){address+=", "+aMarker.state}if(aMarker.zip!==""){address+=", "+aMarker.zip}if(aMarker.country!==""){address+=", "+aMarker.country}return address};this.createMarkerContent=function(thisMarker){thisMarker["fullAddress"]=this.__createAddress(thisMarker);return slplus.options.bubblelayout.replace_shortcodes(thisMarker)};this.get_search_options=function(){if(this.search_options===null){this.search_options=JSON.parse(JSON.stringify(slplus.options));delete this.search_options.bubblelayout;delete this.search_options.results_header;delete this.search_options.results_header_1;delete this.search_options.results_header_2;delete this.search_options.results_header_3;delete this.search_options.results_header_4;delete this.search_options.resultslayout;delete this.search_options.searchlayout;delete this.search_options.locations;delete this.search_options.layout}return this.search_options};this.getSearchAddress=function(defaultAddress){var searchAddress=jQuery("#addressInput").val();if(!searchAddress){if(typeof cslmap!=="undefined"&&cslmap.usingSensor&&slp.sensor.lat!==0&&slp.sensor.lng!==0){searchAddress=slp.sensor.lat+","+slp.sensor.lng}else{searchAddress=defaultAddress}}return searchAddress};this.saneValue=function(id,defaultValue){var name=document.getElementById(id);if(name===null){name=defaultValue.trim()}else{name=name.value.trim()}return name};this.load_markers=function(center,radius){var action,store_name,tags;if(center===null){center=this.gmap.getCenter()}this.lastCenter=center;this.lastRadius=radius;action={action:"csl_ajax_search",address:this.saneValue("addressInput","no address entered"),formdata:jQuery("#searchForm").serialize(),lat:center.lat(),lng:center.lng(),options:this.get_search_options(),radius:radius};store_name=this.saneValue("nameSearch","");if(store_name!==""){action["store_name"]=store_name}tags=this.saneValue("tag_to_search_for","");if(tags!==""){action["tags"]=tags}slp_Filter("load_marker_action").publish(action);if(slplus.options.immediately_show_locations!=="0"){action.action="csl_ajax_onload";slplus.options.immediately_show_locations="0";this.search_options=null}slp.send_ajax(action,_this.process_ajax_response)};this.process_ajax_response=function(response){valid_response=typeof response.response!=="undefined";if(valid_response){valid_response=response.success}slp_Filter("location_search_responded").publish(response);if(valid_response){cslmap.latest_response=response;cslmap.clearMarkers();slp_Filter("locations_found").publish(response);cslmap.putMarkers(response.response);jQuery("#map").trigger("markers_dropped")}else{if(window.console){slp.log("SLP server did not send back a valid JSONP response.");if(typeof response!=="undefined"){slp.log("Response: "+response)}if(typeof response.message!=="undefined"){var sidebar=document.getElementById("map_sidebar");sidebar.innerHTML=response.message}}}slp_Filter("location_search_processed").publish()};this.searchLocations=function(){var append_this=typeof slplus.options.append_to_search!=="undefined"&&slplus.options.append_to_search?" "+slplus.options.append_to_search.trim():"";var address=this.saneValue("addressInput","")+append_this;this.unhide_map();google.maps.event.trigger(this.gmap,"resize");if(address){this.address=address;this.doGeocode()}else{this.load_markers(null,this.saneValue("radiusSelect","40000"))}};this.createSidebar=function(currentLocation){currentLocation.pro_tags="";if(jQuery.trim(currentLocation.tags)!==""){var tagclass=currentLocation.tags.replace(/\W/g,"_");currentLocation.pro_tags='<br/><div class="'+tagclass+' slp_result_table_tags"><span class="tagtext">'+currentLocation.tags+"</span></div>"}currentLocation.phone_with_label=jQuery.trim(currentLocation.phone)!==""?slplus.options["label_phone"]+currentLocation.phone:"";currentLocation.fax_with_label=jQuery.trim(currentLocation.fax)!==""?slplus.options["label_fax"]+currentLocation.fax:"";var address=this.__createAddress(currentLocation);currentLocation.location_address=encodeURIComponent(address);currentLocation.search_address=encodeURIComponent(this.getSearchAddress(this.address));currentLocation.hours_sanitized=jQuery("<div/>").html(currentLocation.hours).text();var inner_html={content:slplus.options.resultslayout.replace_shortcodes(currentLocation),finished:false};slp_Filter("wrap_location_results").publish(inner_html);if(!inner_html.finished){inner_html.content='<div class="results_wrapper" id="slp_results_wrapper_'+currentLocation.id+'">'+inner_html.content+"</div>"}return inner_html.content};this.unhide_map=function(){if(this.map_hidden){jQuery("#map_box_image").hide();jQuery("#map_box_map").show();this.map_hidden=false}};this.__init()}});
var slp;jQuery(function($){slp.send_ajax=function(action,callback){$.post(slplus.ajaxurl,action,function(response){try{response=JSON.parse(response)}catch(ex){}callback(response)})};$(document).ready(slp.run)});
;window.Modernizr=function(a,b,c){function C(a){j.cssText=a}function D(a,b){return C(n.join(a+";")+(b||""))}function E(a,b){return typeof a===b}function F(a,b){return!!~(""+a).indexOf(b)}function G(a,b){for(var d in a){var e=a[d];if(!F(e,"-")&&j[e]!==c)return b=="pfx"?e:!0}return!1}function H(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:E(f,"function")?f.bind(d||b):f}return!1}function I(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+" "+p.join(d+" ")+d).split(" ");return E(b,"string")||E(b,"undefined")?G(e,b):(e=(a+" "+q.join(d+" ")+d).split(" "),H(e,b,c))}function J(){e.input=function(c){for(var d=0,e=c.length;d<e;d++)u[c[d]]=c[d]in k;return u.list&&(u.list=!!b.createElement("datalist")&&!!a.HTMLDataListElement),u}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),e.inputtypes=function(a){for(var d=0,e,f,h,i=a.length;d<i;d++)k.setAttribute("type",f=a[d]),e=k.type!=="text",e&&(k.value=l,k.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(f)&&k.style.WebkitAppearance!==c?(g.appendChild(k),h=b.defaultView,e=h.getComputedStyle&&h.getComputedStyle(k,null).WebkitAppearance!=="textfield"&&k.offsetHeight!==0,g.removeChild(k)):/^(search|tel)$/.test(f)||(/^(url|email)$/.test(f)?e=k.checkValidity&&k.checkValidity()===!1:e=k.value!=l)),t[a[d]]=!!e;return t}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var d="2.6.2",e={},f=!0,g=b.documentElement,h="modernizr",i=b.createElement(h),j=i.style,k=b.createElement("input"),l=":)",m={}.toString,n=" -webkit- -moz- -o- -ms- ".split(" "),o="Webkit Moz O ms",p=o.split(" "),q=o.toLowerCase().split(" "),r={svg:"http://www.w3.org/2000/svg"},s={},t={},u={},v=[],w=v.slice,x,y=function(a,c,d,e){var f,i,j,k,l=b.createElement("div"),m=b.body,n=m||b.createElement("body");if(parseInt(d,10))while(d--)j=b.createElement("div"),j.id=e?e[d]:h+(d+1),l.appendChild(j);return f=["&#173;",'<style id="s',h,'">',a,"</style>"].join(""),l.id=h,(m?l:n).innerHTML+=f,n.appendChild(l),m||(n.style.background="",n.style.overflow="hidden",k=g.style.overflow,g.style.overflow="hidden",g.appendChild(n)),i=c(l,a),m?l.parentNode.removeChild(l):(n.parentNode.removeChild(n),g.style.overflow=k),!!i},z=function(){function d(d,e){e=e||b.createElement(a[d]||"div"),d="on"+d;var f=d in e;return f||(e.setAttribute||(e=b.createElement("div")),e.setAttribute&&e.removeAttribute&&(e.setAttribute(d,""),f=E(e[d],"function"),E(e[d],"undefined")||(e[d]=c),e.removeAttribute(d))),e=null,f}var a={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return d}(),A={}.hasOwnProperty,B;!E(A,"undefined")&&!E(A.call,"undefined")?B=function(a,b){return A.call(a,b)}:B=function(a,b){return b in a&&E(a.constructor.prototype[b],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if(typeof c!="function")throw new TypeError;var d=w.call(arguments,1),e=function(){if(this instanceof e){var a=function(){};a.prototype=c.prototype;var f=new a,g=c.apply(f,d.concat(w.call(arguments)));return Object(g)===g?g:f}return c.apply(b,d.concat(w.call(arguments)))};return e}),s.flexbox=function(){return I("flexWrap")},s.canvas=function(){var a=b.createElement("canvas");return!!a.getContext&&!!a.getContext("2d")},s.canvastext=function(){return!!e.canvas&&!!E(b.createElement("canvas").getContext("2d").fillText,"function")},s.webgl=function(){return!!a.WebGLRenderingContext},s.touch=function(){var c;return"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:y(["@media (",n.join("touch-enabled),("),h,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(a){c=a.offsetTop===9}),c},s.geolocation=function(){return"geolocation"in navigator},s.postmessage=function(){return!!a.postMessage},s.websqldatabase=function(){return!!a.openDatabase},s.indexedDB=function(){return!!I("indexedDB",a)},s.hashchange=function(){return z("hashchange",a)&&(b.documentMode===c||b.documentMode>7)},s.history=function(){return!!a.history&&!!history.pushState},s.draganddrop=function(){var a=b.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a},s.websockets=function(){return"WebSocket"in a||"MozWebSocket"in a},s.rgba=function(){return C("background-color:rgba(150,255,150,.5)"),F(j.backgroundColor,"rgba")},s.hsla=function(){return C("background-color:hsla(120,40%,100%,.5)"),F(j.backgroundColor,"rgba")||F(j.backgroundColor,"hsla")},s.multiplebgs=function(){return C("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(j.background)},s.backgroundsize=function(){return I("backgroundSize")},s.borderimage=function(){return I("borderImage")},s.borderradius=function(){return I("borderRadius")},s.boxshadow=function(){return I("boxShadow")},s.textshadow=function(){return b.createElement("div").style.textShadow===""},s.opacity=function(){return D("opacity:.55"),/^0.55$/.test(j.opacity)},s.cssanimations=function(){return I("animationName")},s.csscolumns=function(){return I("columnCount")},s.cssgradients=function(){var a="background-image:",b="gradient(linear,left top,right bottom,from(#9f9),to(white));",c="linear-gradient(left top,#9f9, white);";return C((a+"-webkit- ".split(" ").join(b+a)+n.join(c+a)).slice(0,-a.length)),F(j.backgroundImage,"gradient")},s.cssreflections=function(){return I("boxReflect")},s.csstransforms=function(){return!!I("transform")},s.csstransforms3d=function(){var a=!!I("perspective");return a&&"webkitPerspective"in g.style&&y("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b,c){a=b.offsetLeft===9&&b.offsetHeight===3}),a},s.csstransitions=function(){return I("transition")},s.fontface=function(){var a;return y('@font-face {font-family:"font";src:url("https://")}',function(c,d){var e=b.getElementById("smodernizr"),f=e.sheet||e.styleSheet,g=f?f.cssRules&&f.cssRules[0]?f.cssRules[0].cssText:f.cssText||"":"";a=/src/i.test(g)&&g.indexOf(d.split(" ")[0])===0}),a},s.generatedcontent=function(){var a;return y(["#",h,"{font:0/0 a}#",h,':after{content:"',l,'";visibility:hidden;font:3px/1 a}'].join(""),function(b){a=b.offsetHeight>=3}),a},s.video=function(){var a=b.createElement("video"),c=!1;try{if(c=!!a.canPlayType)c=new Boolean(c),c.ogg=a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),c.h264=a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),c.webm=a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")}catch(d){}return c},s.audio=function(){var a=b.createElement("audio"),c=!1;try{if(c=!!a.canPlayType)c=new Boolean(c),c.ogg=a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),c.mp3=a.canPlayType("audio/mpeg;").replace(/^no$/,""),c.wav=a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),c.m4a=(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,"")}catch(d){}return c},s.localstorage=function(){try{return localStorage.setItem(h,h),localStorage.removeItem(h),!0}catch(a){return!1}},s.sessionstorage=function(){try{return sessionStorage.setItem(h,h),sessionStorage.removeItem(h),!0}catch(a){return!1}},s.webworkers=function(){return!!a.Worker},s.applicationcache=function(){return!!a.applicationCache},s.svg=function(){return!!b.createElementNS&&!!b.createElementNS(r.svg,"svg").createSVGRect},s.inlinesvg=function(){var a=b.createElement("div");return a.innerHTML="<svg/>",(a.firstChild&&a.firstChild.namespaceURI)==r.svg},s.smil=function(){return!!b.createElementNS&&/SVGAnimate/.test(m.call(b.createElementNS(r.svg,"animate")))},s.svgclippaths=function(){return!!b.createElementNS&&/SVGClipPath/.test(m.call(b.createElementNS(r.svg,"clipPath")))};for(var K in s)B(s,K)&&(x=K.toLowerCase(),e[x]=s[K](),v.push((e[x]?"":"no-")+x));return e.input||J(),e.addTest=function(a,b){if(typeof a=="object")for(var d in a)B(a,d)&&e.addTest(d,a[d]);else{a=a.toLowerCase();if(e[a]!==c)return e;b=typeof b=="function"?b():b,typeof f!="undefined"&&f&&(g.className+=" "+(b?"":"no-")+a),e[a]=b}return e},C(""),i=k=null,function(a,b){function k(a,b){var c=a.createElement("p"),d=a.getElementsByTagName("head")[0]||a.documentElement;return c.innerHTML="x<style>"+b+"</style>",d.insertBefore(c.lastChild,d.firstChild)}function l(){var a=r.elements;return typeof a=="string"?a.split(" "):a}function m(a){var b=i[a[g]];return b||(b={},h++,a[g]=h,i[h]=b),b}function n(a,c,f){c||(c=b);if(j)return c.createElement(a);f||(f=m(c));var g;return f.cache[a]?g=f.cache[a].cloneNode():e.test(a)?g=(f.cache[a]=f.createElem(a)).cloneNode():g=f.createElem(a),g.canHaveChildren&&!d.test(a)?f.frag.appendChild(g):g}function o(a,c){a||(a=b);if(j)return a.createDocumentFragment();c=c||m(a);var d=c.frag.cloneNode(),e=0,f=l(),g=f.length;for(;e<g;e++)d.createElement(f[e]);return d}function p(a,b){b.cache||(b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag()),a.createElement=function(c){return r.shivMethods?n(c,a,b):b.createElem(c)},a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+l().join().replace(/\w+/g,function(a){return b.createElem(a),b.frag.createElement(a),'c("'+a+'")'})+");return n}")(r,b.frag)}function q(a){a||(a=b);var c=m(a);return r.shivCSS&&!f&&!c.hasCSS&&(c.hasCSS=!!k(a,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),j||p(a,c),a}var c=a.html5||{},d=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,e=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,f,g="_html5shiv",h=0,i={},j;(function(){try{var a=b.createElement("a");a.innerHTML="<xyz></xyz>",f="hidden"in a,j=a.childNodes.length==1||function(){b.createElement("a");var a=b.createDocumentFragment();return typeof a.cloneNode=="undefined"||typeof a.createDocumentFragment=="undefined"||typeof a.createElement=="undefined"}()}catch(c){f=!0,j=!0}})();var r={elements:c.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:c.shivCSS!==!1,supportsUnknownElements:j,shivMethods:c.shivMethods!==!1,type:"default",shivDocument:q,createElement:n,createDocumentFragment:o};a.html5=r,q(b)}(this,b),e._version=d,e._prefixes=n,e._domPrefixes=q,e._cssomPrefixes=p,e.hasEvent=z,e.testProp=function(a){return G([a])},e.testAllProps=I,e.testStyles=y,e.prefixed=function(a,b,c){return b?I(a,b,c):I(a,"pfx")},g.className=g.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(f?" js "+v.join(" "):""),e}(this,this.document),function(a,b,c){function d(a){return"[object Function]"==o.call(a)}function e(a){return"string"==typeof a}function f(){}function g(a){return!a||"loaded"==a||"complete"==a||"uninitialized"==a}function h(){var a=p.shift();q=1,a?a.t?m(function(){("c"==a.t?B.injectCss:B.injectJs)(a.s,0,a.a,a.x,a.e,1)},0):(a(),h()):q=0}function i(a,c,d,e,f,i,j){function k(b){if(!o&&g(l.readyState)&&(u.r=o=1,!q&&h(),l.onload=l.onreadystatechange=null,b)){"img"!=a&&m(function(){t.removeChild(l)},50);for(var d in y[c])y[c].hasOwnProperty(d)&&y[c][d].onload()}}var j=j||B.errorTimeout,l=b.createElement(a),o=0,r=0,u={t:d,s:c,e:f,a:i,x:j};1===y[c]&&(r=1,y[c]=[]),"object"==a?l.data=c:(l.src=c,l.type=a),l.width=l.height="0",l.onerror=l.onload=l.onreadystatechange=function(){k.call(this,r)},p.splice(e,0,u),"img"!=a&&(r||2===y[c]?(t.insertBefore(l,s?null:n),m(k,j)):y[c].push(l))}function j(a,b,c,d,f){return q=0,b=b||"j",e(a)?i("c"==b?v:u,a,b,this.i++,c,d,f):(p.splice(this.i++,0,a),1==p.length&&h()),this}function k(){var a=B;return a.loader={load:j,i:0},a}var l=b.documentElement,m=a.setTimeout,n=b.getElementsByTagName("script")[0],o={}.toString,p=[],q=0,r="MozAppearance"in l.style,s=r&&!!b.createRange().compareNode,t=s?l:n.parentNode,l=a.opera&&"[object Opera]"==o.call(a.opera),l=!!b.attachEvent&&!l,u=r?"object":l?"script":"img",v=l?"script":u,w=Array.isArray||function(a){return"[object Array]"==o.call(a)},x=[],y={},z={timeout:function(a,b){return b.length&&(a.timeout=b[0]),a}},A,B;B=function(a){function b(a){var a=a.split("!"),b=x.length,c=a.pop(),d=a.length,c={url:c,origUrl:c,prefixes:a},e,f,g;for(f=0;f<d;f++)g=a[f].split("="),(e=z[g.shift()])&&(c=e(c,g));for(f=0;f<b;f++)c=x[f](c);return c}function g(a,e,f,g,h){var i=b(a),j=i.autoCallback;i.url.split(".").pop().split("?").shift(),i.bypass||(e&&(e=d(e)?e:e[a]||e[g]||e[a.split("/").pop().split("?")[0]]),i.instead?i.instead(a,e,f,g,h):(y[i.url]?i.noexec=!0:y[i.url]=1,f.load(i.url,i.forceCSS||!i.forceJS&&"css"==i.url.split(".").pop().split("?").shift()?"c":c,i.noexec,i.attrs,i.timeout),(d(e)||d(j))&&f.load(function(){k(),e&&e(i.origUrl,h,g),j&&j(i.origUrl,h,g),y[i.url]=2})))}function h(a,b){function c(a,c){if(a){if(e(a))c||(j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}),g(a,j,b,0,h);else if(Object(a)===a)for(n in m=function(){var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b}(),a)a.hasOwnProperty(n)&&(!c&&!--m&&(d(j)?j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}:j[n]=function(a){return function(){var b=[].slice.call(arguments);a&&a.apply(this,b),l()}}(k[n])),g(a[n],j,b,n,h))}else!c&&l()}var h=!!a.test,i=a.load||a.both,j=a.callback||f,k=j,l=a.complete||f,m,n;c(h?a.yep:a.nope,!!i),i&&c(i)}var i,j,l=this.yepnope.loader;if(e(a))g(a,0,l,0);else if(w(a))for(i=0;i<a.length;i++)j=a[i],e(j)?g(j,0,l,0):w(j)?B(j):Object(j)===j&&h(j,l);else Object(a)===a&&h(a,l)},B.addPrefix=function(a,b){z[a]=b},B.addFilter=function(a){x.push(a)},B.errorTimeout=1e4,null==b.readyState&&b.addEventListener&&(b.readyState="loading",b.addEventListener("DOMContentLoaded",A=function(){b.removeEventListener("DOMContentLoaded",A,0),b.readyState="complete"},0)),a.yepnope=k(),a.yepnope.executeStack=h,a.yepnope.injectJs=function(a,c,d,e,i,j){var k=b.createElement("script"),l,o,e=e||B.errorTimeout;k.src=a;for(o in d)k.setAttribute(o,d[o]);c=j?h:c||f,k.onreadystatechange=k.onload=function(){!l&&g(k.readyState)&&(l=1,c(),k.onload=k.onreadystatechange=null)},m(function(){l||(l=1,c(1))},e),i?k.onload():n.parentNode.insertBefore(k,n)},a.yepnope.injectCss=function(a,c,d,e,g,i){var e=b.createElement("link"),j,c=i?h:c||f;e.href=a,e.rel="stylesheet",e.type="text/css";for(j in d)e.setAttribute(j,d[j]);g||(n.parentNode.insertBefore(e,n),m(c,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))};